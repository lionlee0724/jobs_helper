# Antigravity 通用工程规则

---

## 第一部分：语言与交互约定

### 1.1 语言约束

| 场景 | 语言要求 |
|------|----------|
| 交互对话 | 简体中文 |
| 内部推理思考 | 简体中文 |
| 文档与计划 | 简体中文（含 task.md、实施计划、注释） |
| 代码标识符 | 英文（禁止拼音） |
| 系统日志/错误输出 | 允许英文原样 |

### 1.2 命令执行规则

**可自动执行（无需确认）**
- 只读命令：`ls`, `dir`, `cat`, `type`, `head`, `tail`, `find`, `grep`
- Git 查看：`git status`, `git diff`, `git log`, `git branch`, `git show`
- 构建测试：`npm test`, `npm run lint`, `npm run build`

**需要用户确认（高危操作）**
- 删除操作：`rm`, `del`, `rmdir`
- Git 修改：`git push`, `git reset`, `git checkout`, `git rebase`
- 安装依赖：`npm install`, `pip install`, `npx`

### 1.3 任务完成工作流

任务执行完毕后：
1. 自动执行 `git status` 检查变动
2. 展示变动文件列表
3. 询问是否提交到 Git 仓库
4. 建议 commit message 并等待确认

---

## 第二部分：技术栈约定

| 领域 | 默认技术选型 |
|------|-------------|
| 前端 | React + TypeScript |
| 后端 | Python（优先 FastAPI） |

> 若无特殊说明，均遵循以上技术选型。

---

## 第三部分：通用代码规范

### 3.1 命名规范

| 类型 | 命名风格 | 示例 |
|------|----------|------|
| 变量 / 函数 | camelCase | `getUserInfo` |
| 类 / 组件 | PascalCase | `UserCard` |
| 常量 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT` |
| 文件 / 文件夹 | kebab-case | `user-profile.tsx` |

> 命名应语义清晰，禁止随意缩写。

### 3.2 注释规范

**基本原则**
- 注释用于解释「为什么这样设计」，而非代码字面含义
- 复杂逻辑、业务判断、边界条件必须写注释
- 禁止无意义注释

**统一注释标记**

```ts
// TODO: 待实现功能
// FIXME: 已知问题或潜在缺陷
// NOTE: 重要设计说明
// HACK: 临时方案，后续必须重构
```

**函数注释格式**

前端（JSDoc）：
```ts
/**
 * 获取用户信息
 * @param userId - 用户 ID
 * @returns 用户数据
 */
```

后端（Python Docstring）：
```python
def get_user(user_id: str) -> User:
    """根据用户 ID 获取用户信息"""
```

---

## 第四部分：前端规范（React）

### 4.1 基本原则

- 使用函数组件，不使用类组件
- 单个组件只承担单一职责
- 展示逻辑与业务逻辑分离
- 可复用逻辑必须抽离为自定义 Hook

### 4.2 命名约定

- 组件名使用 PascalCase
- 文件名与组件名保持一致
- 自定义 Hook 必须以 `use` 开头

```ts
function UserCard() {}
function useUserData() {}
```

### 4.3 Hooks 使用规范

- 只能在函数组件或自定义 Hook 中调用
- 不允许在条件、循环中调用
- 一个 Hook 只处理一种职责

### 4.4 Props 规范

- 必须使用 TypeScript 类型定义
- 使用解构方式接收 props
- 非必传参数使用 `?`

```ts
interface UserCardProps {
  user: User
  onClick?: () => void
}
```

### 4.5 性能优化

- 避免不必要的重复渲染
- 合理使用 `useMemo` / `useCallback`
- 列表渲染必须提供稳定的 `key`
- 大数据列表使用虚拟滚动
- 路由与组件支持懒加载

---

## 第五部分：后端规范（Python）

### 5.1 基本要求

- Python ≥ 3.10
- 优先使用 FastAPI
- 所有函数与方法必须标注类型
- 禁止使用裸 `except`
- 禁止使用 `print` 作为日志方式

### 5.2 分层架构

| 层级 | 职责 |
|------|------|
| `api/` | 请求解析与响应封装 |
| `service/` | 业务逻辑处理 |
| `repository/` | 数据库访问 |
| `schema/` | 请求/响应数据校验 |
| `model/` | ORM 模型定义 |

> **禁止在 api 层直接操作数据库。**

### 5.3 日志规范

- 使用 `logging` 模块
- 合理区分日志级别：`DEBUG` / `INFO` / `WARNING` / `ERROR`
- 日志中不得包含敏感信息

---

## 第六部分：安全规范

### 6.1 通用原则

- 永远不信任客户端输入
- 所有输入必须进行校验
- 敏感操作必须经过身份与权限校验

### 6.2 前端安全

- 禁止使用 `dangerouslySetInnerHTML`
- 防止 XSS / CSRF 攻击
- 不在前端存储敏感信息
- Token 推荐使用 HttpOnly Cookie

### 6.3 后端安全

- 使用 Pydantic 进行参数校验
- 权限校验必须在 service 层完成
- 所有密钥从环境变量中读取：
  ```python
  import os
  SECRET_KEY = os.getenv("SECRET_KEY")
  ```
- 敏感字段返回前需脱敏
- 密码等敏感数据必须加密存储

---

## 第七部分：AI 协作规范

所有 AI 自动生成的代码必须遵守本规则，生成结果应满足：

- ✅ 结构清晰
- ✅ 类型完整
- ✅ 可维护
- ✅ 安全
- ❌ 不生成不必要的复杂实现